<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<!-- BEGIN opengraph metadata -->
<meta property="og:title" content="Doxygen Awesome" />
<meta property="og:image" content="https://repository-images.githubusercontent.com/348492097/4f16df80-88fb-11eb-9d31-4015ff22c452" />
<meta property="og:description" content="Custom CSS theme for doxygen html-documentation with lots of customization parameters." />
<meta property="og:url" content="https://jothepro.github.io/doxygen-awesome-css/" />
<!-- END opengraph metadata -->
<!-- BEGIN twitter metadata -->
<meta name="twitter:image:src" content="https://repository-images.githubusercontent.com/348492097/4f16df80-88fb-11eb-9d31-4015ff22c452" />
<meta name="twitter:title" content="Doxygen Awesome" />
<meta name="twitter:description" content="Custom CSS theme for doxygen html-documentation with lots of customization parameters." />
<!-- END twitter metadata -->
<title>deeseek-model-visualizer: modeling_deepseek Namespace Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link rel="icon" type="image/svg+xml" href="logo.drawio.svg"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
<script type="text/javascript" src="doxygen-awesome-fragment-copy-button.js"></script>
<script type="text/javascript" src="doxygen-awesome-paragraph-link.js"></script>
<script type="text/javascript" src="doxygen-awesome-interactive-toc.js"></script>
<script type="text/javascript" src="doxygen-awesome-tabs.js"></script>
<script type="text/javascript" src="toggle-alternative-theme.js"></script>
<script type="text/javascript">
    DoxygenAwesomeFragmentCopyButton.init()
    DoxygenAwesomeDarkModeToggle.init()
    DoxygenAwesomeParagraphLink.init()
    DoxygenAwesomeInteractiveToc.init()
    DoxygenAwesomeTabs.init()
</script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- https://tholman.com/github-corners/ -->
<a href="https://github.com/jothepro/doxygen-awesome-css" class="github-corner" title="View source on GitHub" target="_blank" rel="noopener noreferrer">
    <svg viewBox="0 0 250 250" width="40" height="40" style="position: absolute; top: 0; border: 0; right: 0; z-index: 99;" aria-hidden="true">
    <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">deeseek-model-visualizer
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part --><!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('namespacemodeling__deepseek.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle"><div class="title">modeling_deepseek Namespace Reference</div></div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="nested-classes" name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmodeling__deepseek_1_1DeepseekV3Attention.html">DeepseekV3Attention</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmodeling__deepseek_1_1DeepseekV3DecoderLayer.html">DeepseekV3DecoderLayer</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmodeling__deepseek_1_1DeepseekV3DynamicNTKScalingRotaryEmbedding.html">DeepseekV3DynamicNTKScalingRotaryEmbedding</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmodeling__deepseek_1_1DeepseekV3FlashAttention2.html">DeepseekV3FlashAttention2</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmodeling__deepseek_1_1DeepseekV3ForCausalLM.html">DeepseekV3ForCausalLM</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmodeling__deepseek_1_1DeepseekV3ForSequenceClassification.html">DeepseekV3ForSequenceClassification</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmodeling__deepseek_1_1DeepseekV3LinearScalingRotaryEmbedding.html">DeepseekV3LinearScalingRotaryEmbedding</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmodeling__deepseek_1_1DeepseekV3MLP.html">DeepseekV3MLP</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmodeling__deepseek_1_1DeepseekV3Model.html">DeepseekV3Model</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmodeling__deepseek_1_1DeepseekV3MoE.html">DeepseekV3MoE</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmodeling__deepseek_1_1DeepseekV3PreTrainedModel.html">DeepseekV3PreTrainedModel</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmodeling__deepseek_1_1DeepseekV3RMSNorm.html">DeepseekV3RMSNorm</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmodeling__deepseek_1_1DeepseekV3RotaryEmbedding.html">DeepseekV3RotaryEmbedding</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmodeling__deepseek_1_1DeepseekV3YarnRotaryEmbedding.html">DeepseekV3YarnRotaryEmbedding</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmodeling__deepseek_1_1MoEGate.html">MoEGate</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:aff225c90cb4b2622f8872d0c3f584b3d" id="r_aff225c90cb4b2622f8872d0c3f584b3d"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aff225c90cb4b2622f8872d0c3f584b3d">_get_unpad_data</a> (attention_mask)</td></tr>
<tr class="separator:aff225c90cb4b2622f8872d0c3f584b3d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5773fca3051b7ea373ce0a49be2ea763" id="r_a5773fca3051b7ea373ce0a49be2ea763"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a5773fca3051b7ea373ce0a49be2ea763">yarn_find_correction_dim</a> (num_rotations, dim, base=10000, max_position_embeddings=2048)</td></tr>
<tr class="separator:a5773fca3051b7ea373ce0a49be2ea763"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab17059a7c13afd5df5eda1a07fe7e6b7" id="r_ab17059a7c13afd5df5eda1a07fe7e6b7"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ab17059a7c13afd5df5eda1a07fe7e6b7">yarn_find_correction_range</a> (low_rot, high_rot, dim, base=10000, max_position_embeddings=2048)</td></tr>
<tr class="separator:ab17059a7c13afd5df5eda1a07fe7e6b7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a34b414bdb0bddfa5b31edbc45c4a85de" id="r_a34b414bdb0bddfa5b31edbc45c4a85de"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a34b414bdb0bddfa5b31edbc45c4a85de">yarn_get_mscale</a> (scale=1, mscale=1)</td></tr>
<tr class="separator:a34b414bdb0bddfa5b31edbc45c4a85de"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a241d0772b349f4669077765b46345cdf" id="r_a241d0772b349f4669077765b46345cdf"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a241d0772b349f4669077765b46345cdf">yarn_linear_ramp_mask</a> (min, max, dim)</td></tr>
<tr class="separator:a241d0772b349f4669077765b46345cdf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac3015cd18af85cbf60800ee0a8091b87" id="r_ac3015cd18af85cbf60800ee0a8091b87"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ac3015cd18af85cbf60800ee0a8091b87">rotate_half</a> (x)</td></tr>
<tr class="separator:ac3015cd18af85cbf60800ee0a8091b87"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1a750b896c05148a865beae617cc3153" id="r_a1a750b896c05148a865beae617cc3153"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a1a750b896c05148a865beae617cc3153">apply_rotary_pos_emb</a> (q, k, cos, sin, position_ids, unsqueeze_dim=1)</td></tr>
<tr class="separator:a1a750b896c05148a865beae617cc3153"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5bf7ad188a9dfd9846300c6e3708cd1a" id="r_a5bf7ad188a9dfd9846300c6e3708cd1a"><td class="memItemLeft" align="right" valign="top">torch.Tensor&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a5bf7ad188a9dfd9846300c6e3708cd1a">repeat_kv</a> (torch.Tensor hidden_states, int n_rep)</td></tr>
<tr class="separator:a5bf7ad188a9dfd9846300c6e3708cd1a"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="var-members" name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a8d9baef5b34c8ef4b2f1ea6334ba2266" id="r_a8d9baef5b34c8ef4b2f1ea6334ba2266"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a8d9baef5b34c8ef4b2f1ea6334ba2266">_prepare_4d_causal_attention_mask</a> = torch.fx.wrap(_prepare_4d_causal_attention_mask)</td></tr>
<tr class="separator:a8d9baef5b34c8ef4b2f1ea6334ba2266"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae57b9b10039f9c6cc3805df718ae3968" id="r_ae57b9b10039f9c6cc3805df718ae3968"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ae57b9b10039f9c6cc3805df718ae3968">logger</a> = logging.get_logger(__name__)</td></tr>
<tr class="separator:ae57b9b10039f9c6cc3805df718ae3968"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a881e5dbefaf2df66dcee12dbd1e82010" id="r_a881e5dbefaf2df66dcee12dbd1e82010"><td class="memItemLeft" align="right" valign="top">str&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a881e5dbefaf2df66dcee12dbd1e82010">_CONFIG_FOR_DOC</a> = &quot;DeepseekV3Config&quot;</td></tr>
<tr class="separator:a881e5dbefaf2df66dcee12dbd1e82010"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab4fe0f13f22eb77598df89bc23c86276" id="r_ab4fe0f13f22eb77598df89bc23c86276"><td class="memItemLeft" align="right" valign="top">dict&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ab4fe0f13f22eb77598df89bc23c86276">ATTENTION_CLASSES</a></td></tr>
<tr class="separator:ab4fe0f13f22eb77598df89bc23c86276"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac35047c78f8be4b60c37f16178f47dbc" id="r_ac35047c78f8be4b60c37f16178f47dbc"><td class="memItemLeft" align="right" valign="top">str&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ac35047c78f8be4b60c37f16178f47dbc">DeepseekV3_START_DOCSTRING</a></td></tr>
<tr class="separator:ac35047c78f8be4b60c37f16178f47dbc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0da3ab896abddeea5125328ccd7ba754" id="r_a0da3ab896abddeea5125328ccd7ba754"><td class="memItemLeft" align="right" valign="top">str&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a0da3ab896abddeea5125328ccd7ba754">DeepseekV3_INPUTS_DOCSTRING</a></td></tr>
<tr class="separator:a0da3ab896abddeea5125328ccd7ba754"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><pre class="fragment"> PyTorch DeepSeek model.</pre> </div><h2 class="groupheader">Function Documentation</h2>
<a id="aff225c90cb4b2622f8872d0c3f584b3d" name="aff225c90cb4b2622f8872d0c3f584b3d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aff225c90cb4b2622f8872d0c3f584b3d">&#9670;&#160;</a></span>_get_unpad_data()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">modeling_deepseek._get_unpad_data </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>attention_mask</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<pre class="fragment">Retrieve unpadded data from the attention mask.

This function processes the given attention mask to extract the indices
of non-zero elements, compute cumulative sequence lengths, and determine
the maximum sequence length in the batch. It is particularly useful in
scenarios where attention masks are used to manage variable-length
sequences in batch processing.

Args:
    attention_mask (torch.Tensor): A tensor representing the attention mask, where non-zero values
        indicate valid tokens and zero values indicate padding.

Returns:
    tuple: A tuple containing:
        - indices (torch.Tensor): A flattened tensor of indices corresponding to
        non-zero elements
        in the attention mask.
        - cu_seqlens (torch.Tensor): A tensor of cumulative sequence lengths,
        padded to facilitate
        batch processing.
        - max_seqlen_in_batch (int): The maximum sequence length found in the
        input batch.
</pre> 
</div>
</div>
<a id="a1a750b896c05148a865beae617cc3153" name="a1a750b896c05148a865beae617cc3153"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1a750b896c05148a865beae617cc3153">&#9670;&#160;</a></span>apply_rotary_pos_emb()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">modeling_deepseek.apply_rotary_pos_emb </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>q</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>k</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>cos</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>sin</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>position_ids</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>unsqueeze_dim</em><span class="paramdefsep"> = </span><span class="paramdefval">1</span></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Applies Rotary Position Embedding to the query and key tensors.

This function modifies the query and key tensors by applying rotary
position embeddings using the provided cosine and sine tensors. The
position indices are used to select the appropriate values from the
cosine and sine tensors, which are then unsqueezed along the specified
dimension to ensure they can be broadcasted correctly with the query and
key tensors. This is particularly useful in transformer models for
enhancing the positional encoding of tokens.

Args:
    q (`torch.Tensor`): The query tensor.
    k (`torch.Tensor`): The key tensor.
    cos (`torch.Tensor`): The cosine part of the rotary embedding.
    sin (`torch.Tensor`): The sine part of the rotary embedding.
    position_ids (`torch.Tensor`): The position indices of the tokens corresponding to the query and key
        tensors. For example, this can be
        used to pass offsetted position ids when working with a KV-cache.
    unsqueeze_dim (`int`, *optional*, defaults to 1): The 'unsqueeze_dim' argument specifies the dimension along which to
        unsqueeze cos[position_ids] and
        sin[position_ids] so that they can be properly broadcasted to the
        dimensions of q and k. For example, note
        that cos[position_ids] and sin[position_ids] have the shape [batch_size,
        seq_len, head_dim]. Then, if q and
        k have the shape [batch_size, heads, seq_len, head_dim], then setting
        unsqueeze_dim=1 makes
        cos[position_ids] and sin[position_ids] broadcastable to the shapes of q
        and k. Similarly, if q and k have
        the shape [batch_size, seq_len, heads, head_dim], then set
        unsqueeze_dim=2.

Returns:
    the Rotary Position Embedding.
</pre> <div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacemodeling__deepseek_a1a750b896c05148a865beae617cc3153_cgraph.svg" width="480" height="51"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a5bf7ad188a9dfd9846300c6e3708cd1a" name="a5bf7ad188a9dfd9846300c6e3708cd1a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5bf7ad188a9dfd9846300c6e3708cd1a">&#9670;&#160;</a></span>repeat_kv()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"> torch.Tensor modeling_deepseek.repeat_kv </td>
          <td>(</td>
          <td class="paramtype">torch.Tensor</td>          <td class="paramname"><span class="paramname"><em>hidden_states</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>n_rep</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Repeat key-value hidden states for attention mechanisms.

This function takes the hidden states of a model and repeats them along
the specified dimension, effectively expanding the representation of
key-value pairs for attention heads. The input tensor is expected to
have the shape (batch, num_key_value_heads, seqlen, head_dim) and will
be reshaped to (batch, num_attention_heads, seqlen, head_dim) after
repeating the key-value pairs.

Args:
    hidden_states (torch.Tensor): A tensor containing the hidden states with shape
        (batch, num_key_value_heads, seqlen, head_dim).
    n_rep (int): The number of times to repeat each key-value pair.

Returns:
    torch.Tensor: A tensor with the repeated hidden states, reshaped to
        (batch, num_key_value_heads * n_rep, seqlen, head_dim).
</pre> 
</div>
</div>
<a id="ac3015cd18af85cbf60800ee0a8091b87" name="ac3015cd18af85cbf60800ee0a8091b87"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac3015cd18af85cbf60800ee0a8091b87">&#9670;&#160;</a></span>rotate_half()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">modeling_deepseek.rotate_half </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>x</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Rotate half of the hidden dimensions of the input tensor.

This function takes an input tensor and splits it into two halves along
the last dimension. The first half is kept as is, while the second half
is negated. The two halves are then concatenated along the last
dimension to produce the output tensor.

Args:
    x (torch.Tensor): The input tensor with at least two dimensions.

Returns:
    torch.Tensor: A tensor with the same shape as the input, where the second half of the
    last dimension has been negated.
</pre> <div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacemodeling__deepseek_ac3015cd18af85cbf60800ee0a8091b87_icgraph.svg" width="480" height="51"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a5773fca3051b7ea373ce0a49be2ea763" name="a5773fca3051b7ea373ce0a49be2ea763"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5773fca3051b7ea373ce0a49be2ea763">&#9670;&#160;</a></span>yarn_find_correction_dim()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">modeling_deepseek.yarn_find_correction_dim </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>num_rotations</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>dim</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>base</em><span class="paramdefsep"> = </span><span class="paramdefval">10000</span>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>max_position_embeddings</em><span class="paramdefsep"> = </span><span class="paramdefval">2048</span></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Calculate the corrected dimension based on the number of rotations.

This function computes the corrected dimension using the inverse
dimension formula. It takes into account the number of rotations and
adjusts the dimension based on a logarithmic scale relative to a base
value and the maximum position embeddings. The formula used is derived
from mathematical principles related to dimensionality adjustments in
various applications.

Args:
    num_rotations (int): The number of rotations to consider in the calculation.
    dim (float): The initial dimension value to be corrected.
    base (float?): The base value for logarithmic scaling. Defaults to 10000.
    max_position_embeddings (int?): The maximum number of position embeddings.
        Defaults to 2048.

Returns:
    float: The corrected dimension based on the provided parameters.
</pre> <div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacemodeling__deepseek_a5773fca3051b7ea373ce0a49be2ea763_icgraph.svg" width="432" height="51"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="ab17059a7c13afd5df5eda1a07fe7e6b7" name="ab17059a7c13afd5df5eda1a07fe7e6b7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab17059a7c13afd5df5eda1a07fe7e6b7">&#9670;&#160;</a></span>yarn_find_correction_range()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">modeling_deepseek.yarn_find_correction_range </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>low_rot</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>high_rot</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>dim</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>base</em><span class="paramdefsep"> = </span><span class="paramdefval">10000</span>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>max_position_embeddings</em><span class="paramdefsep"> = </span><span class="paramdefval">2048</span></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Find the correction range bounds based on rotation values.

This function calculates the lower and upper bounds for a correction
range based on the provided rotation values. It uses the
`yarn_find_correction_dim` function to determine the corresponding
dimensions for the given low and high rotation inputs. The results are
clamped to ensure they remain within valid bounds, specifically between
0 and `dim - 1`.

Args:
    low_rot (float): The lower rotation value.
    high_rot (float): The higher rotation value.
    dim (int): The dimension size to constrain the bounds.
    base (int?): The base value used in calculations. Defaults to 10000.
    max_position_embeddings (int?): The maximum number of position embeddings. Defaults to 2048.

Returns:
    tuple: A tuple containing the clamped lower and upper bounds of the correction
        range.
</pre> <div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacemodeling__deepseek_ab17059a7c13afd5df5eda1a07fe7e6b7_cgraph.svg" width="432" height="51"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a34b414bdb0bddfa5b31edbc45c4a85de" name="a34b414bdb0bddfa5b31edbc45c4a85de"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a34b414bdb0bddfa5b31edbc45c4a85de">&#9670;&#160;</a></span>yarn_get_mscale()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">modeling_deepseek.yarn_get_mscale </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>scale</em><span class="paramdefsep"> = </span><span class="paramdefval">1</span>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>mscale</em><span class="paramdefsep"> = </span><span class="paramdefval">1</span></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Calculate the modified scale based on the input scale and mscale.

This function computes a modified scale value using a logarithmic
transformation. If the input scale is less than or equal to 1, it
returns a default value of 1.0. For scales greater than 1, it applies
the formula: 0.1 * mscale * log(scale) + 1.0.

Args:
    scale (float?): The input scale value. Defaults to 1.
    mscale (float?): The mscale value used in the calculation. Defaults to 1.

Returns:
    float: The modified scale value based on the input parameters.
</pre> 
</div>
</div>
<a id="a241d0772b349f4669077765b46345cdf" name="a241d0772b349f4669077765b46345cdf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a241d0772b349f4669077765b46345cdf">&#9670;&#160;</a></span>yarn_linear_ramp_mask()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">modeling_deepseek.yarn_linear_ramp_mask </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>min</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>max</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>dim</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Generate a linear ramp mask based on minimum and maximum values.

This function creates a linear ramp mask that linearly interpolates
values between a specified minimum and maximum. If the minimum and
maximum values are equal, a small value is added to the maximum to
prevent singularity. The resulting ramp is clamped between 0 and 1,
ensuring that all values lie within this range.

Args:
    min (float): The minimum value for the ramp.
    max (float): The maximum value for the ramp.
    dim (int): The dimension of the output mask.

Returns:
    torch.Tensor: A tensor containing the linear ramp mask.
</pre> 
</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="a881e5dbefaf2df66dcee12dbd1e82010" name="a881e5dbefaf2df66dcee12dbd1e82010"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a881e5dbefaf2df66dcee12dbd1e82010">&#9670;&#160;</a></span>_CONFIG_FOR_DOC</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">str modeling_deepseek._CONFIG_FOR_DOC = &quot;DeepseekV3Config&quot;</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a id="a8d9baef5b34c8ef4b2f1ea6334ba2266" name="a8d9baef5b34c8ef4b2f1ea6334ba2266"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8d9baef5b34c8ef4b2f1ea6334ba2266">&#9670;&#160;</a></span>_prepare_4d_causal_attention_mask</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">modeling_deepseek._prepare_4d_causal_attention_mask = torch.fx.wrap(_prepare_4d_causal_attention_mask)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a id="ab4fe0f13f22eb77598df89bc23c86276" name="ab4fe0f13f22eb77598df89bc23c86276"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab4fe0f13f22eb77598df89bc23c86276">&#9670;&#160;</a></span>ATTENTION_CLASSES</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">dict modeling_deepseek.ATTENTION_CLASSES</td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Initial value:</b><div class="fragment"><div class="line"><span class="lineno">    1</span>=  {</div>
<div class="line"><span class="lineno">    2</span>    <span class="stringliteral">&quot;eager&quot;</span>: DeepseekV3Attention,</div>
<div class="line"><span class="lineno">    3</span>    <span class="stringliteral">&quot;flash_attention_2&quot;</span>: DeepseekV3FlashAttention2,</div>
<div class="line"><span class="lineno">    4</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a0da3ab896abddeea5125328ccd7ba754" name="a0da3ab896abddeea5125328ccd7ba754"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0da3ab896abddeea5125328ccd7ba754">&#9670;&#160;</a></span>DeepseekV3_INPUTS_DOCSTRING</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">str modeling_deepseek.DeepseekV3_INPUTS_DOCSTRING</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="ac35047c78f8be4b60c37f16178f47dbc" name="ac35047c78f8be4b60c37f16178f47dbc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac35047c78f8be4b60c37f16178f47dbc">&#9670;&#160;</a></span>DeepseekV3_START_DOCSTRING</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">str modeling_deepseek.DeepseekV3_START_DOCSTRING</td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Initial value:</b><div class="fragment"><div class="line"><span class="lineno">    1</span>=  <span class="stringliteral">r&quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">    2</span><span class="stringliteral">    This model inherits from [`PreTrainedModel`]. Check the superclass documentation for the generic methods the</span></div>
<div class="line"><span class="lineno">    3</span><span class="stringliteral">    library implements for all its model (such as downloading or saving, resizing the input embeddings, pruning heads</span></div>
<div class="line"><span class="lineno">    4</span><span class="stringliteral">    etc.)</span></div>
<div class="line"><span class="lineno">    5</span><span class="stringliteral">    This model is also a PyTorch [torch.nn.Module](https://pytorch.org/docs/stable/nn.html#torch.nn.Module) subclass.</span></div>
<div class="line"><span class="lineno">    6</span><span class="stringliteral">    Use it as a regular PyTorch Module and refer to the PyTorch documentation for all matter related to general usage</span></div>
<div class="line"><span class="lineno">    7</span><span class="stringliteral">    and behavior.</span></div>
<div class="line"><span class="lineno">    8</span><span class="stringliteral">    Parameters:</span></div>
<div class="line"><span class="lineno">    9</span><span class="stringliteral">        config ([`DeepseekV3Config`]):</span></div>
<div class="line"><span class="lineno">   10</span><span class="stringliteral">            Model configuration class with all the parameters of the model. Initializing with a config file does not</span></div>
<div class="line"><span class="lineno">   11</span><span class="stringliteral">            load the weights associated with the model, only the configuration. Check out the</span></div>
<div class="line"><span class="lineno">   12</span><span class="stringliteral">            [`~PreTrainedModel.from_pretrained`] method to load the model weights.</span></div>
<div class="line"><span class="lineno">   13</span><span class="stringliteral">&quot;&quot;&quot;</span></div>
</div><!-- fragment -->
</div>
</div>
<a id="ae57b9b10039f9c6cc3805df718ae3968" name="ae57b9b10039f9c6cc3805df718ae3968"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae57b9b10039f9c6cc3805df718ae3968">&#9670;&#160;</a></span>logger</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">modeling_deepseek.logger = logging.get_logger(__name__)</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.10.0-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespacemodeling__deepseek.html">modeling_deepseek</a></li>
    <li class="footer">Generated by <a href="https://penify.dev/"><img class="footer" src="https://www.penify.dev/_next/static/media/snorkell-dark-logo.9fa414f5.svg" width="104" height="31" alt="doxygen"/></a> </li>
  </ul>
</div>
</body>
</html>
